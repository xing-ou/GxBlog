"use strict";(self.webpackChunkgx_blog=self.webpackChunkgx_blog||[]).push([[5070],{3905:function(e,n,r){r.d(n,{Zo:function(){return c},kt:function(){return m}});var t=r(67294);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=t.createContext({}),u=function(e){var n=t.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},c=function(e){var n=u(e.components);return t.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(r),m=a,g=p["".concat(l,".").concat(m)]||p[m]||d[m]||o;return r?t.createElement(g,i(i({ref:n},c),{},{components:r})):t.createElement(g,i({ref:n},c))}));function m(e,n){var r=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=p;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=r[u];return t.createElement.apply(null,i)}return t.createElement.apply(null,r)}p.displayName="MDXCreateElement"},43317:function(e,n,r){r.r(n),r.d(n,{assets:function(){return c},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return d}});var t=r(83117),a=r(80102),o=(r(67294),r(3905)),i=["components"],s={title:"SwiftUI\u4e13\u8f91072-Combine\u548cForm",tags:["swiftUI","Combine"]},l=void 0,u={permalink:"/2022/01/14/SwiftUI\u4e13\u8f91-072-Combine\u548cForm",editUrl:"https://github.com/xing-ou/GxBlog/blog/2022-01-14-SwiftUI\u4e13\u8f91-072-Combine\u548cForm/index.md",source:"@site/blog/2022-01-14-SwiftUI\u4e13\u8f91-072-Combine\u548cForm/index.md",title:"SwiftUI\u4e13\u8f91072-Combine\u548cForm",description:"headerimg",date:"2022-01-14T00:00:00.000Z",formattedDate:"2022\u5e741\u670814\u65e5",tags:[{label:"swiftUI",permalink:"/tags/swift-ui"},{label:"Combine",permalink:"/tags/combine"}],readingTime:4.22,truncated:!0,authors:[],frontMatter:{title:"SwiftUI\u4e13\u8f91072-Combine\u548cForm",tags:["swiftUI","Combine"]},prevItem:{title:"SwiftUI\u4e13\u8f91073-Combine\u548c\u7f51\u7edc\u8bf7\u6c42",permalink:"/2022/01/15/SwiftUI\u4e13\u8f91-073-Combine\u548c\u7f51\u7edc\u8bf7\u6c42"},nextItem:{title:"SwiftUI\u4e13\u8f91071-\u4e00\u4e2a\u5b9a\u65f6\u5668App",permalink:"/2022/01/13/SwiftUI\u4e13\u8f91-071-\u4e00\u4e2a\u5b9a\u65f6\u5668App"}},c={authorsImageUrls:[]},d=[{value:"Getting ready",id:"getting-ready",level:2},{value:"How to do it\u2026",id:"how-to-do-it",level:2},{value:"How it works\u2026",id:"how-it-works",level:2}],p={toc:d};function m(e){var n=e.components,s=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,t.Z)({},p,s,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"headerimg",src:r(3563).Z,width:"700",height:"250"}),"\n\u672c\u7ae0\uff0c\u6211\u4eec\u5c06\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u6ce8\u518c\u9875\u9762\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u7528\u6237\u540d\u8f93\u5165\u6846\u548c\u4e24\u4e2a\u5bc6\u7801\u8f93\u5165\u6846\uff0c\u4e00\u4e2a\u7528\u4e8e\u5bc6\u7801\uff0c\u53e6\u4e00\u4e2a\u7528\u4e8e\u786e\u8ba4\u5bc6\u7801\u3002"),(0,o.kt)("p",null,"\u7528\u6237\u540d\u6700\u5c116\u4e2a\u5b57\u7b26\uff0c\u5bc6\u7801\u81f3\u5c11\u6709\u516b\u4e2a\u5b57\u7b26\uff0c\u4e14\u7531\u6570\u5b57\u3001\u5927\u5199\u5b57\u6bcd\u3001\u5c0f\u5199\u5b57\u6bcd\u548c\u7279\u6b8a\u5b57\u7b26\u7ec4\u6210\uff0c\u4f8b\u5982",(0,o.kt)("em",{parentName:"p"},"\uff01"),", ",(0,o.kt)("em",{parentName:"p"},"#")," , ",(0,o.kt)("em",{parentName:"p"},"$"),"\u7b49\u7b49\u3002\u6b64\u5916\uff0c\u5bc6\u7801\u548c\u786e\u8ba4\u5bc6\u7801\u5fc5\u987b\u5339\u914d\u3002\u5f53\u6240\u6709\u5b57\u6bb5\u90fd\u6709\u6548\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u5165\u4e0b\u4e00\u9875\u3002"),(0,o.kt)("h2",{id:"getting-ready"},"Getting ready"),(0,o.kt)("p",null,"\u9996\u5148\uff0c\u65b0\u5efa\u4e00\u4e2a\u9879\u76ee\uff1a",(0,o.kt)("strong",{parentName:"p"},"FormValidation")),(0,o.kt)("h2",{id:"how-to-do-it"},"How to do it\u2026"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u9996\u5148\uff0c\u6211\u4eec\u521b\u5efa\u597d\u6211\u4eec\u7684ViewModel")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},'class SignupViewModel: ObservableObject {\n    //\u8f93\u5165\n    @Published var username = ""\n    @Published var password = ""\n    @Published var confirmPassword = ""\n    //\u8f93\u51fa\n    @Published var isValid = false\n    @Published var usernameMessage = ""\n    @Published var passwordMessage = ""\n    private var cancellableSet: Set<AnyCancellable> = []\n}\n')),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"\u6211\u4eec\u5f00\u59cb\u51c6\u5907\u903b\u8f91")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},"enum PasswordCheck {\n    case valid\n    case invalidLength\n    case noMatch\n    case weakPassword\n}\n\nextension SignupViewModel {\n    // \u7528\u6237\u540d\u662f\u5426\u6709\u6548(\u81f3\u5c116\u4e2a\u5b57\u7b26)\n    var usernameValidPublisher: AnyPublisher<Bool, Never> {\n        return $username\n            .debounce(for: 0.5, scheduler: RunLoop.main)\n            .removeDuplicates()\n            .map { $0.count >= 6 }\n            .eraseToAnyPublisher()\n    }\n    //\u5bc6\u7801\u957f\u5ea6\u81f3\u5c118\u4f4d\n    var validPasswordLengthPublisher: AnyPublisher<Bool, Never> {\n        return $password\n            .debounce(for: 0.5, scheduler: RunLoop.main, options: nil)\n            .removeDuplicates()\n            .map { $0.count >= 8 }\n            .eraseToAnyPublisher()\n    }\n    //\u7531\u6570\u5b57\u548c\u5b57\u6bcd\u7ec4\u6210\uff0c\u81f3\u5c11\u6709\u4e00\u4e2a\u5927\u5199\u5b57\u6bcd\u548c\u4e00\u4e2a\u7279\u6b8a\u5b57\u7b26\n    var strongPasswordPublisher: AnyPublisher<Bool, Never> {\n        return $password\n            .debounce(for: 0.2, scheduler: RunLoop.main, options: nil)\n            .removeDuplicates()\n            .map(\\.isStrong)\n            .eraseToAnyPublisher()\n    }\n    //\u4e24\u4e2a\u5bc6\u7801\u5339\u914d\n    var matchingPasswordsPublisher: AnyPublisher<Bool, Never> {\n        return Publishers.CombineLatest($password, $confirmPassword)\n            .debounce(for: 0.2, scheduler: RunLoop.main, options: nil)\n            .map { password, confirmedPassword in\n                password == confirmedPassword\n            }.eraseToAnyPublisher()\n    }\n    //\u5bc6\u7801\u6709\u6548\n    var passwordValidPublisher: AnyPublisher<PasswordCheck, Never> {\n        return Publishers.CombineLatest3(validPasswordLengthPublisher, strongPasswordPublisher, matchingPasswordsPublisher)\n            .map { validLength, strong, matching in\n                if (!validLength) { return .invalidLength }\n                if (!strong) { return .weakPassword }\n                if (!matching) { return .noMatch }\n                return .valid\n            }.eraseToAnyPublisher()\n    }\n    //\u6574\u4e2aForm\u6709\u6548\n    var formValidPublisher: AnyPublisher<Bool, Never> {\n        return Publishers.CombineLatest(usernameValidPublisher, passwordValidPublisher)\n            .map { usernameIsValid, passwordIsValid in\n                return usernameIsValid && (passwordIsValid == .valid)\n            }.eraseToAnyPublisher()\n    }\n}\n\nextension String {\n    var isStrong: Bool {\n        containsACharacter(from: .lowercaseLetters) &&//\u5305\u542b\u5b57\u6bcd\n        containsACharacter(from: .uppercaseLetters) &&\n        containsACharacter(from: .decimalDigits) && //\u5305\u542b\u6570\u5b57\n        containsACharacter(from: .alphanumerics.inverted)\n    }\n\n    private func containsACharacter(from set: CharacterSet) -> Bool {\n        rangeOfCharacter(from: set) != nil\n    }\n}\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"\u5f00\u59cb\u7ed1\u5b9a")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},'class SignupViewModel: ObservableObject {\n  ....\n//\u7ed1\u5b9a\ninit() {\n    usernameValidPublisher\n        .receive(on: RunLoop.main)\n        .map { $0 ? "" : "Username must be at least 6 characters" }\n        .assign(to: \\.usernameMessage, on: self)\n        .store(in: &cancellableSet)\n    passwordValidPublisher\n        .receive(on: RunLoop.main)\n        .map { passwordCheck in\n            switch passwordCheck {\n            case .invalidLength:\n                return "Password must be at least 8 characters long"\n            case .noMatch:\n                return "Passwords don\'t match"\n            case .weakPassword:\n                return "Password is too weak"\n            default:\n                return " "\n            }\n        }.assign(to: \\.passwordMessage, on: self)\n        .store(in: &cancellableSet)\n\n    formValidPublisher\n        .receive(on: RunLoop.main)\n        .assign(to: \\.isValid, on: self)\n        .store(in: &cancellableSet)\n}\n}\n')),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"\u6784\u5efaUI")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},'struct CustomStyle: ViewModifier {\n    func body(content: Content) -> some View {\n        content\n            .frame(height: 40)\n            .background(Color.white)\n            .cornerRadius(5)\n    }\n}\n\nextension TextField {\n    func custom() -> some View {\n        modifier(CustomStyle())\n            .autocapitalization(.none)\n    }\n}\n\nextension SecureField {\n    func custom() -> some View {\n        modifier(CustomStyle())\n    }\n}\n\n@available(iOS 15.0, *)\nstruct ContentView: View {\n    @ObservedObject\n    private var signupViewModel = SignupViewModel()\n\n    var body: some View {\n        ZStack {\n            Color.yellow.opacity(0.2)\n            VStack(spacing: 24) {\n                VStack(alignment: .leading) {\n                    Text(signupViewModel.usernameMessage)\n                        .foregroundColor(.red)\n                    TextField("Username", text: $signupViewModel.username)\n                        .custom()\n                }\n                VStack(alignment: .leading) {\n                    Text(signupViewModel.passwordMessage)\n                        .foregroundColor(.red)\n                    SecureField("Password", text: $signupViewModel.password)\n                        .custom()\n                    SecureField("Repeat Password", text: $signupViewModel.confirmPassword)\n                        .custom()\n                }\n                Button {\n                    print("Succesfully registered!")\n                } label: {\n                    Text("Register")\n                        .foregroundColor(.white)\n                        .frame(width: 100, height: 44)\n                        .background(signupViewModel.isValid ? Color.green : Color.red)\n                        .cornerRadius(10)\n                }.disabled(!signupViewModel.isValid)\n            }\n            .padding(.horizontal, 24)\n        }\n        .edgesIgnoringSafeArea(.all)\n    }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://tva1.sinaimg.cn/large/008i3skNgy1gyd888iflcj30b40b4gm2.jpg",alt:"Figure_10.6_B17962"})),(0,o.kt)("h2",{id:"how-it-works"},"How it works\u2026"),(0,o.kt)("p",null,"\u6211\u4eec\u6ce8\u610f\u4ee5\u4e0b\u51e0\u70b9\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u6211\u4eec\u7684\u6bcf\u4e2apublisher\u540e\u9762\u90fd\u6709\u4e2a",(0,o.kt)("strong",{parentName:"li"},"eraseToAnyPublisher()"),", \u539f\u56e0\u662f\u6211\u4eec\u524d\u9762\u7ec4\u5408\u591a\u4e2a\u4fee\u9970\u7b26\u4f1a\u521b\u5efa\u4e00\u4e9b\u590d\u6742\u7684\u5d4c\u5957\u7c7b\u578b\uff0c\u800c\u6211\u4eec\u5e0c\u671b\u7684\u8f93\u51fa\u53ea\u662f\u4e00\u4e2aPublisher\u3002\u901a\u8fc7eraseToAnyPublisher\u80fd\u5c06\u590d\u6742\u7684\u5d4c\u5957\u7c7b\u578b\u8f6c\u6362\u6210\u4e00\u4e2aPublisher\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u6211\u4eec\u901a\u8fc7 ",(0,o.kt)("strong",{parentName:"li"},".debounce()")," \uff0c\u9632\u6b62\u7528\u6237\u5feb\u901f\u8f93\u5165\u65f6\uff0c\u4ea7\u751f\u5927\u91cf\u7684event\u3002"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},".map(",".","isStrong)"),"\u8ba9\u6211\u4eec\u80fd\u591f\u4ee5keypath\u4f5c\u4e3a\u53c2\u6570\uff0c\u7b49\u4ef7\u4e8e\u4e0b\u9762\u7684")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},".map { password in\n\n    return password.isStrong\n\n}\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Publishers.CombineLatest")," \u548c ",(0,o.kt)("strong",{parentName:"li"},"Publishers.CombineLatest3"),"\u5c06\u591a\u4e2apublisher\u7ec4\u5408\u8d77\u6765\u3002")))}m.isMDXComponent=!0},3563:function(e,n,r){n.Z=r.p+"assets/images/Header-5960030cb1b81fd199601d5bd0f9c8b8.png"}}]);